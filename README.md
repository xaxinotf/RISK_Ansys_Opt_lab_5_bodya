
---

# Ординальна оцінка ризику в банківських та платіжних системах

Інтерактивний **Dash**-застосунок (Python 3.10), що реалізує **ординальний підхід** до оцінювання ризику банківської/платіжної системи за набором індикаторів: без використання абсолютних одиниць — лише **порядкові ранги**, ваги та агрегування в інтегральний показник ризику. Містить візуалізації, експорт та інструменти аналізу узгодженості індикаторів.

---

## Завдання 

> **Тема:** Ризик у банківських та платіжних системах.
> **Мета:** Застосувати **ординальний підхід** для оцінки ризику банківської системи:
>
> * побудувати ранги банків за кожним індикатором ризику;
> * врахувати **напрям впливу** індикатора (більше = гірше / більше = краще);
> * ввести **ваги індикаторів**;
> * **агрегувати** ранги в інтегральний ризик (метод Борда / зважене середнє нормованих рангів);
> * оцінити **узгодженість** індикаторів за коефіцієнтом **Кендалла W**;
> * представити результати у вигляді графіків/таблиць, сформувати короткі висновки.

---

## Методологія 

### 1) Ординальні ранги

Для кожного індикатора $k$ формуємо ранги $r_{ik}$ для банків $i \in \{1..n\}$ з урахуванням **напряму впливу**:

* `direction = +1` → **більше = гірше**, отже **менше значення краще** → отримує **ранг 1**;
* `direction = -1` → **більше = краще**, отже **більше значення краще** → отримує **ранг 1**.

Використовуємо метод ранжування `average` (усереднення при «тай-брейках»).









## 2) Агрегування в інтегральний ризик

Нехай маємо $n$ банків (або платіжних установ) та $m$ індикаторів.  
Позначимо $r_{ik}$ — ранг $i$-го банку за $k$-м індикатором,  
а $w_k \ge 0$ — вагу $k$-го індикатора, причому:

$$
\sum_{k=1}^m w_k = 1
$$

---

### • Борда (зважена сума рангів)

Інтегральний ризик за методом Борда визначається як:

$$
Score_i^{\text{borda}} = \sum_{k=1}^m w_k \cdot r_{ik}
$$

- Чим менше значення $Score_i^{\text{borda}}$, тим **краща** (безпечніша) позиція банку.  
- Для зручності порівняння нормуємо результати до інтервалу $[0,1]$:

$$
Score_i^{\text{norm}} = \frac{Score_i^{\text{borda}} - \min_j Score_j^{\text{borda}}}{\max_j Score_j^{\text{borda}} - \min_j Score_j^{\text{borda}}}
$$

---

### • Зважене середнє нормованих рангів

Спочатку нормуємо ранги кожного індикатора до $[0,1]$:

$$
\tilde{r}_{ik} = \frac{r_{ik} - 1}{n - 1}, \quad \tilde{r}_{ik} \in [0,1]
$$

Тоді інтегральний ризик обчислюється як:

$$
Score_i^{\text{avg}} = \sum_{k=1}^m w_k \cdot \tilde{r}_{ik}
$$

- Менше значення $Score_i^{\text{avg}}$ означає кращу позицію.  
- На відміну від Борда, тут усі індикатори приводяться до єдиної шкали, що робить результати більш інтерпретованими.

---

## 3) Узгодженість індикаторів — Кендалл W

Щоб оцінити, наскільки **узгоджені** індикатори у своєму ранжуванні банків,  
використовують коефіцієнт конкордації Кендалла $W$.

Нехай матриця рангів має розмір $R \in \mathbb{R}^{n \times m}$,  
де $n$ — кількість банків, $m$ — кількість індикаторів.

Позначимо:

- $R_i = \sum_{k=1}^m r_{ik}$ — сумарний ранг $i$-го банку,
- $\bar{R} = \frac{1}{n}\sum_{i=1}^n R_i$ — середнє значення сумарних рангів.

Тоді коефіцієнт Кендалла обчислюється як:

$$
W = \frac{12 \sum_{i=1}^n (R_i - \bar{R})^2}{m^2 \cdot (n^3 - n)}, \quad W \in [0,1]
$$

---

### Інтерпретація:

- $W \approx 1$ — індикатори дають **майже однакове** упорядкування банків (висока узгодженість).  
- $W \approx 0$ — індикатори ранжують банки **хаотично**, узгодженості немає.  

> Таким чином, Кендалл $W$ дозволяє перевірити, чи можна довіряти комплексному індексу ризику,  
> або ж індикатори суперечать один одному.















## Функціонал застосунку

* **Редагування індикаторів**: назва, опис, **напрям впливу** (+1/−1), **вага**.
* **Редагування даних банків** у таблиці (значення індикаторів), додавання нових банків.
* **Агрегування**:

  * **Борда** (зважена сума рангів);
  * **Зважене середнє нормованих рангів**.
* **Узгодженість індикаторів**: автоматичний розрахунок **Kendall’s W**.
* **Візуалізації**:

  * **теплокарта рангів** (1 = краще),
  * **барчарт інтегрального ризику** (0..1, нижче = краще),
  * **деталізація по банку**: нормовані ранги та фактичні значення індикаторів.
* **Експорт CSV**: метадані, значення, ранги, ризик та нормований ризик.

---

## Структура репозиторію 

```
RISK_Ansys_Opt_lab_5_bodya/
├─ app.py                 # головний код Dash-застосунку
├─ requirements.txt       # залежності (dash, plotly, pandas, numpy)
└─ README.md              # цей файл
```

> За потреби додайте `data/` з вашими CSV, або `docs/` для матеріалів доповіді.

---

## Встановлення та запуск

Вимоги: **Python 3.10**, **pip**, бажано **virtualenv** / **venv**.

```bash
git clone https://github.com/xaxinotf/RISK_Ansys_Opt_lab_5_bodya
cd RISK_Ansys_Opt_lab_5_bodya

python -m venv .venv
# Windows:
.venv\Scripts\activate
# Linux/macOS:
source .venv/bin/activate

pip install -r requirements.txt

python app.py
```

Після старту відкрий у браузері:
**[http://127.0.0.1:8050](http://127.0.0.1:8050)**

---

##  Опис коду (`app.py`)

### Дані за замовчуванням

* `INDICATORS_META` — таблиця з індикаторами ризику:
  `indicator`, `direction` (+1/-1), `weight`, `desc`.
* `VALUES` — синтетичні значення індикаторів для прикладу (банки в рядках).

> Ці таблиці редагуються прямо в UI.

### Утиліти

* `safe_float` — безпечне приведення до числа.
* `normalize_weights` — нормалізація ваг до $\sum w=1$.
* `compute_ranks(df_vals, meta)` — ранги за кожним індикатором з урахуванням **напряму впливу**.
* `aggregate_risk(ranks, weights, agg_mode)` — інтегральний ризик (Борда / середнє норм. рангів).
* `kendall_w(ranks)` — узгодженість індикаторів.
* `risk_bucket(x)` — категоризація інтегрального ризику на `Low/Medium/High` (за терцилями).

### Dash Layout

* **Таблиця індикаторів** (редаговані: напрям, вага, опис).
* **Таблиця банків** (редаговані значення індикаторів, кнопка «Додати банк»).
* Вибір **режиму агрегування** та **банку для деталізації**.
* Графіки: `ranks-heatmap`, `risk-bars`, `focus-indicators`.
* **Експорт CSV**.

### Callbacks

* `add_bank` — додає порожній рядок у таблицю банків.
* `export_csv` — збирає всі дані та зберігає у CSV (meta/values/ranks/risk).
* `update_all` — перераховує ранги, ризик, Kendall’s W; оновлює всі графіки та коротке зведення.

---

##  Як користуватися 

1. **Перевір індикатори** у блоці “Індикатори та ваги”:

   * задай **напрям впливу**: `+1` якщо більше — **гірше**; `-1` якщо більше — **краще**;
   * онови **ваги** (наприклад, надійності — більші ваги).
2. **Введи дані** по банках/платіжних установах у відповідній таблиці, за потреби **додай банк**.
3. Обери **режим агрегування**:

   * **Борда** — класичний сумарний ранг (з вагами);
   * **Зважене середнє нормованих рангів** — усе в інтервалі $[0,1]$.
4. Подивись:

   * **Теплокарту рангів** (1 = краще),
   * **Інтегральний ризик** (барчарт, нижче = краще),
   * **Kendall’s W** (узгодженість індикаторів),
   * **Деталізацію по банку** (які індикатори тягнуть розподіл).
5. За потреби — **Експорт CSV**.

---

##  Інтерпретація результатів

* **Ранг 1** — найкраще місце за індикатором (з урахуванням напряму).
* **Низький інтегральний ризик** (ближче до 0) — банк стабільніший.
* **Kendall’s W ≈ 1** — індикатори дають схожий порядок банків; **W ≈ 0** — суперечливі.
* Якщо **W низький**, корисно:

  * переглянути список індикаторів (видалити збої чи дублікати),
  * скоригувати **ваги**,
  * розділити аналіз на **кластери індикаторів** (напр., платіжні vs. капітал/ліквідність).

---

## Питання–Відповіді 

Які індикатори додавати?
 -Типові: NPL, ліквідність, CAR, левередж, ROA/ROE, збій платежів, затримки розрахунків, інциденти шахрайства. Напрям впливу вибери правильно!

Можна завантажити свої дані з CSV?
-Зараз — редагування вручну через таблицю. Легко додати імпорт з CSV, якщо потрібно (напиши issue).

Чим відрізняються два режими агрегування?
-Борда — сумує сирі ранги; «середнє нормованих» — використовує 0..1 шкалу для кожного індикатора, що спрощує інтерпретацію.

---

##  Розширення (що легко додати)

* Інші методи агрегування (Copeland, медіана рангу, TOPSIS на рангах).
* Групи індикаторів (модульні ваги).
* Імпорт/експорт у XLSX.
* Генерація **.pptx**/**.docx** звіту з графіками автоматично.

---

##  Залежності


```
dash>=3.0
plotly>=5.22
pandas>=2.0
numpy>=1.24
```

---




